# Houjin Align トップページ 画面設計書

このドキュメントは、Houjin Align のトップページ（CSV アップロード画面）の画面設計書です。画面の構成、機能、各要素の仕様を定義します。

## 1. 画面概要

### 1.1 画面名

トップページ（CSV アップロード画面）

### 1.2 画面の目的

ユーザーが CSV/Excel ファイルをアップロードし、法人情報のチェック処理を実行するための画面です。アップロード後は、処理結果とレコード一覧を表示します。

### 1.3 アクセス方法

- URL: `/`（ルートパス）
- 認証: 現在は認証不要（将来的に認証機能を追加する可能性あり）

## 2. 主機能

この画面で提供する機能は以下の通りです。

### 2.1 ファイル選択

- ユーザーが CSV または Excel ファイル（`.csv`, `.xlsx`, `.xls`）を選択できる
- ファイル選択は `<input type="file">` 要素を使用
- 選択可能なファイル形式は `accept=".csv,.xlsx,.xls"` で制限

### 2.2 アップロード

- 選択したファイルをバックエンド API に送信する
- アップロード中はボタンが無効化され、「アップロード中…」と表示される
- アップロード完了後、結果が画面に表示される

### 2.3 アップロード結果表示

アップロードが成功した場合、以下の情報を表示します：

- **ファイル名**: アップロードされたファイルの名前
- **文字コード**: ファイルの文字コード（例: `utf-8-sig`, `shift_jis`）
- **レコード数**: ファイル内のレコード件数

### 2.4 レコード一覧表示

アップロードされたファイルの各レコードをテーブル形式で表示します。テーブルの列は以下の通りです：

- 行番号
- 法人番号
- 名称
- 照合ステータス

### 2.5 照合ステータス（将来追加）

現在は全レコードが「未照合」として表示されますが、将来的には以下のステータスを表示する予定です：

- **一致（OK）**: 元データと国税庁の正式情報が一致
- **不一致（NG）**: 元データと国税庁の正式情報が不一致
- **要確認（NEED_CHECK）**: 手動確認が必要な状態

## 3. 画面ブロック構成

画面は以下のブロックで構成されます。

### 3.1 ヘッダー

画面最上部に配置されるヘッダーセクションです。

- **タイトル**: 「Houjin Align（法人情報チェックツール）」
  - フォントサイズ: `28px`
  - フォントウェイト: `700`（太字）
  - 色: `#1a1a1a`

- **サブタイトル**: 「CSV/Excel ファイルをアップロードして法人情報チェックを行うためのツールの試作版です。」
  - フォントサイズ: `15px`
  - 色: `#666`（グレー）
  - 行間: `1.8`

### 3.2 アップロードカード

ファイル選択とアップロードボタンを配置するカードです。

- **カードタイトル**: 「CSVファイルをアップロード」
  - フォントサイズ: `18px`
  - フォントウェイト: `600`

- **説明文**: 「CSV/Excel ファイルを選択してアップロードボタンをクリックしてください。」
  - フォントサイズ: `14px`
  - 色: `#666`

- **ファイル選択**:
  - ラベル: 「ファイルを選択:」
  - 入力要素: `<input type="file">` で、最大幅 `400px`

- **アップロードボタン**:
  - テキスト: 「アップロード」（通常時）、「アップロード中…」（処理中）
  - 背景色: `#0070f3`（青）
  - 無効状態: ファイル未選択時またはアップロード中は `disabled`

- **エラーメッセージ**（エラー発生時）:
  - 背景色: `#fee`（淡い赤）
  - ボーダー: `1px solid #fcc`
  - テキスト色: `#c00`

### 3.3 結果カード

アップロード成功後に表示されるカードです。アップロードカードの下に配置されます。

- **カードタイトル**: 「アップロード結果」
  - フォントサイズ: `20px`
  - フォントウェイト: `600`
  - 下部にボーダー（`2px solid #f0f0f0`）を表示

- **成功メッセージ**:
  - アイコン: ✅（チェックマーク）
  - タイトル: 「アップロード成功」
  - 情報表示:
    - ファイル名: `{result.filename}`
    - 文字コード: `{result.encoding}`
    - レコード数: `{result.count} 件`
  - 背景色: `#f0fdf4`（淡い緑）
  - ボーダー: `1px solid #bbf7d0`
  - テキスト色: `#166534`（濃い緑）

### 3.4 テーブルエリア

レコード一覧を表示するテーブルエリアです。結果カード内に配置されます。

- **セクションタイトル**: 「レコード一覧」
  - フォントサイズ: `16px`
  - フォントウェイト: `600`
  - 色: `#333`

- **テーブル**:
  - 横スクロール対応（`.table-wrapper` で包む）
  - ヘッダー行: 背景色 `#f5f5f5`、テキスト色 `#555`、フォントウェイト `600`
  - データ行: ホバー時に背景色が `#fafafa` に変化
  - セルパディング: `12px 16px`

## 4. テーブル項目仕様

レコード一覧テーブルの各項目の仕様を以下に示します。

| 項目 | 説明 | データソース | 表示例 | 備考 |
|------|------|------------|--------|------|
| 行番号 | 1から始まる連番 | フロントエンドで生成（`index + 1`） | 1 | テーブル内の順序を表す |
| 法人番号 | CSV/Excel ファイルから読み込んだ法人番号 | `record.corp_number` | 1234567890123 | 13桁の数字。値がない場合は `-` を表示 |
| 名称 | CSV/Excel ファイルから読み込んだ法人名称 | `record.company_name` | テスト株式会社 | 値がない場合は `-` を表示 |
| 照合ステータス | 法人番号照合の結果ステータス | 現在は固定値「未照合」 | 未照合 | 将来的には「一致」「不一致」「要確認」などを表示予定。バッジ形式で表示 |

### 4.1 照合ステータスの詳細（将来実装予定）

将来的に実装予定の照合ステータスの種類：

- **一致（OK）**: 元データと国税庁の正式情報が一致している
- **不一致（NG）**: 元データと国税庁の正式情報が不一致
- **要確認（NEED_CHECK）**: API エラーやデータ不備により、手動確認が必要な状態
- **未照合**: まだ照合処理が実行されていない（現在の全レコードの状態）

各ステータスは、色分けされたバッジとして表示する予定です。

## 5. データフロー

### 5.1 アップロード処理の流れ

1. ユーザーがファイルを選択
2. 「アップロード」ボタンをクリック
3. フロントエンドからバックエンド API（`/api/checks/upload`）にファイルを送信
4. バックエンドでファイルをパースし、レコードを抽出
5. バックエンドからレスポンスを返却（ファイル名、文字コード、レコード数、レコード一覧）
6. フロントエンドで結果を表示

### 5.2 エラーハンドリング

- ファイル未選択時: 「ファイルを選択してください」というエラーメッセージを表示
- API エラー時: エラーメッセージを表示（エラーメッセージの内容は API から返される）
- ネットワークエラー時: 「アップロード中にエラーが発生しました」というメッセージを表示

## 6. 状態管理

### 6.1 コンポーネントの状態

`FileUploadForm` コンポーネントは以下の状態を管理します：

- `selectedFile`: 選択されたファイル（`File | null`）
- `isLoading`: アップロード処理中かどうか（`boolean`）
- `result`: アップロード結果（`UploadResponse | null`）
- `error`: エラーメッセージ（`string | null`）

### 6.2 状態の遷移

1. **初期状態**: `selectedFile = null`, `isLoading = false`, `result = null`, `error = null`
2. **ファイル選択後**: `selectedFile` が設定され、`result` と `error` がクリアされる
3. **アップロード開始**: `isLoading = true`, `error = null`, `result = null`
4. **アップロード成功**: `isLoading = false`, `result` が設定される
5. **アップロード失敗**: `isLoading = false`, `error` が設定される

## 7. 将来追加予定の要素

### 7.1 ステータスバッジの色分け

照合ステータスに応じて、バッジの色を変更します：

- **一致（OK）**: 緑系のバッジ（背景色: 淡い緑、テキスト色: 濃い緑）
- **不一致（NG）**: 赤系のバッジ（背景色: 淡い赤、テキスト色: 濃い赤）
- **要確認（NEED_CHECK）**: 黄系のバッジ（背景色: 淡い黄、テキスト色: 濃い黄）
- **未照合**: 現在のグレー系のバッジを維持

### 7.2 CSV ダウンロード機能

結果カードに「CSV ダウンロード」ボタンを追加し、照合結果を CSV 形式でダウンロードできるようにします。

- ボタンの配置: 結果カードの上部（「アップロード結果」タイトルの横または下）
- ダウンロード内容: テーブルに表示されている全レコードのデータ
- ファイル名: `{元のファイル名}_result.csv` など

### 7.3 API 連動ボタン

各レコードに対して、国税庁の法人番号 Web-API を直接呼び出すボタンを追加する可能性があります。

- ボタンの配置: テーブルの「照合ステータス」列の横に「再照合」ボタン
- 機能: そのレコードのみを再照合し、結果を更新

### 7.4 フィルタリング機能

テーブル上部にフィルタリングボタンを追加し、ステータスごとに絞り込み表示できるようにします。

- フィルターオプション: 「すべて」「一致のみ」「不一致のみ」「要確認のみ」
- 実装方法: フロントエンドで `result.records` をフィルタリング

### 7.5 ソート機能

テーブルのヘッダーをクリック可能にし、列ごとにソートできるようにする可能性があります。

- ソート可能な列: 行番号、法人番号、名称、照合ステータス
- ソート方向: 昇順・降順の切り替え

## 8. レスポンシブ対応

### 8.1 デスクトップ（960px 以上）

- コンテナの最大幅: `960px`
- コンテナのパディング: `24px`
- カードのパディング: `24px`

### 8.2 タブレット・スマートフォン（768px 以下）

- コンテナのパディング: `16px`
- ページタイトル: `28px` → `24px`
- カードのパディング: `24px` → `20px`
- テーブル: 横スクロールで全列を表示（角丸と左右のボーダーを削除）

## 9. アクセシビリティ

### 9.1 キーボード操作

- ファイル選択: `Tab` キーでフォーカス移動、`Enter` キーでファイル選択ダイアログを開く
- アップロードボタン: `Tab` キーでフォーカス移動、`Enter` キーまたは `Space` キーでクリック

### 9.2 スクリーンリーダー対応

- ファイル入力には適切な `label` 要素を関連付け（`htmlFor` と `id` で紐付け）
- エラーメッセージや成功メッセージは、適切な `role` 属性や `aria-live` 属性を検討（将来的に実装）

## 10. パフォーマンス

### 10.1 大量レコードの表示

現在の実装では、全レコードを一度に表示します。将来的にレコード数が非常に多い場合（数千件以上）は、以下の対応を検討します：

- ページネーション: 一度に表示するレコード数を制限（例: 100件ずつ）
- 仮想スクロール: 表示領域のみをレンダリングし、スクロール時に動的に追加

### 10.2 アップロード処理の最適化

- アップロード中は、ユーザーに進捗状況を表示する可能性がある（プログレスバーなど）

