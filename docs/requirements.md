# Houjin Align（ホウジン・アライン） 要件定義（たたき台）

このドキュメントは、法人情報チェックツール「Houjin Align」の要件定義書のドラフトです。
後続で機能要件・非機能要件・画面仕様・API仕様を追記します。

## 1. 背景・目的

外部パートナーから提出された法人情報（社名・法人番号・所在地など）は、形式や記述ゆれにより誤りが混入する可能性があります。これらの情報を手作業で確認するには時間がかかり、属人化しやすい課題があります。Houjin Align は、国税庁の法人番号 Web-API から正式情報を取得し、提出データとの一致状況を自動でチェックすることで、確認作業の効率化と正確性の向上を目的としています。

## 2. 用語定義

ここに、「法人番号」「NTA Web-API」など、このドキュメントで使う専門用語の簡単な定義を書く。

## 3. 想定ユーザーと利用シナリオ

想定ユーザーは、外部パートナーとのやり取りを担当する社内メンバーです。利用シナリオとしては、パートナーから受領した法人情報リスト（CSVやExcel）をアップロードし、自動照合された結果を一覧で確認し、不一致・要確認項目を抽出します。これにより、確認作業の工数削減とミス防止を実現します。

## 4. 機能要件

### 4.1 データ入力／アップロード

ユーザーは、外部パートナーから受領した法人情報リスト（CSV または Excel）を画面からアップロードできる。基本となる入力項目は「法人番号」「社名」「所在地」とし、それ以外の列が含まれていても無視される仕様とする。アップロード時に、必須項目の欠落や明らかな形式不備（法人番号の桁数不足など）があれば画面上にエラーを表示し、処理を中断する。

### 4.2 法人番号 API 照会

アップロードされた各レコードについて、国税庁の法人番号 Web-API を使って正式な法人情報を取得する。照会のキーは原則として「法人番号」とし、1件ずつ順番に API を呼び出すシンプルな方式から開始する。API を利用するためのアプリケーションIDは環境変数で管理し、テスト用と本番用を切り替えられるようにする。API エラーや法人番号未登録の場合は、その旨を結果として記録し、後続処理で確認できるようにする。

### 4.3 照合ロジック

API から取得した正式情報と、アップロードされた元データを比較し、「一致」「要確認」「不一致」の3区分で判定する。社名については、全角・半角や株式会社／(株) などの表記ゆれをある程度吸収したうえで比較することを目標とし、初期版ではシンプルな文字列比較から始める。所在地についても、丁目・番地などの細かい違いをすべて吸収するのではなく、まずは大きな差異（都道府県レベルの違いなど）を検知できることを優先する。

### 4.4 結果表示・エクスポート

照合結果は、画面上の一覧として表示し、各行に「元データ」「国税庁の正式情報」「判定ステータス（一致／要確認／不一致）」を並べて確認できるようにする。ユーザーは「要確認」「不一致」のみを絞り込み表示できる簡易フィルタを利用できる。また、画面に表示している内容と同じ情報を CSV ファイルとしてダウンロードできるようにし、後続の確認作業や報告に利用できるようにする。

## 5. 非機能要件

本ツールの初期バージョンでは、以下の非機能要件を最低ラインとして想定する。

### 5.1 性能

- 1回のアップロードで扱うレコード数は、まずは数百〜数千件程度を想定する。
- アップロードから照合結果の表示までの目安時間は、数千件で数分以内を目標とする。
- 国税庁の法人番号 Web-API のレート制限を超えないよう、一定間隔でリクエストを送る。

### 5.2 信頼性

- API エラーやタイムアウトが発生した場合も処理が途中で止まらないようにし、エラーになったレコードは「要確認」として結果に残す。
- 想定外のエラーが発生した場合でも、画面に簡単なメッセージを表示し、原因調査のためにログに記録する。

### 5.3 運用・保守

- アプリケーションIDや接続先URLなどの設定値は、環境変数や設定ファイルで管理し、コードに直書きしない。
- 開発環境・検証環境・本番環境で設定を切り替えられるようにしておく。
- 将来の機能追加を見越し、フロントエンド（Next.js）とバックエンド（FastAPI）は疎結合な構成を意識する。

### 5.4 セキュリティ（非機能観点）

- 国税庁の法人番号 Web-API への接続情報やアプリケーションIDは、Git リポジトリに含めない。
- アクセスログや照合結果に含まれる法人情報は、社内のルールに従って取り扱うことを前提とし、テストデータと本番データを明確に分ける。

## 6. 画面一覧と簡易ワイヤー

本ツールで必要となる画面の構成案は以下のとおりとする。

### 6.1 トップ画面

- ユーザーが最初にアクセスする画面。
- 「ファイルをアップロード」ボタンを配置し、CSV/Excel を選択できる簡易 UI とする。
- 過去の結果一覧などは初期バージョンでは不要とし、最小限の操作だけを提供する。

（ワイヤーイメージ）

## 7. 外部インターフェース（NTA Web-API）

本ツールは、国税庁が提供する「法人番号 Web-API」を利用して、法人の正式情報を取得する。初期バージョンでは、以下のエンドポイントを主に利用する。

### 7.1 利用する主な API エンドポイント

- **法人番号による単一結果取得 API（/api/…/Num）**  
  指定した法人番号に対応する正式な法人情報を1件返す。  
  本ツールの基本照会はすべてこの API を利用する。

### 7.2 主なリクエスト仕様

- メソッド：GET  
- パラメータ：  
  - `id`

## 8. セキュリティ・運用

本ツールは、法人情報および国税庁 Web-API の接続情報を扱うため、最低限以下のセキュリティ・運用ルールを設ける。

### 8.1 アプリケーションID・環境変数の管理

- 国税庁の法人番号 Web-API のアプリケーションIDは、環境変数または .env ファイルで管理し、Git リポジトリには含めない。
- 開発・検証・本番などの環境ごとに設定値を分け、誤って本番用IDを開発環境で使用しないようにする。
- アプリケーションIDの発行・更新・失効の手順は、社内のルールに従って管理する。

### 8.2 アクセス制御

- 初期バージョンでは、社内ネットワークからの利用を前提とした簡易な運用を想定する。
- 将来的に外部パートナーが直接利用する場合は、別途ログイン機能や IP 制限などを検討する。

### 8.3 ログ・監査

- アップロードされたファイル名、処理開始・完了時刻、照合件数、エラー件数などをサーバーログに記録する。
- エラー内容（API エラー、形式不備など）は、原因調査のためにログへ残す。ただし、不要に詳細な個人・法人情報をログに残さないように配慮する。

### 8.4 バックアップ・リカバリ

- 本ツールは基本的に一時的なチェックを行うユーティリティとして設計し、データベースへの恒久保存は必須としない。
- 将来的に履歴保存が必要になった場合は、保存期間や削除ルール（何カ月で削除するか）を別途定義する。

## 9. 今後の検討事項

本ドキュメントは、あくまで初期バージョン（PoC）の要件をまとめたものであり、以下のような拡張・改善アイデアが今後の検討候補となる。

- 大量データ（数万件以上）を対象としたバッチ処理機能の追加
- 過去の照合結果を検索・再表示できる履歴画面の追加
- Excel テンプレートとの連携（指定フォーマットへの自動書き戻し）
- Slack やメールへの簡易レポート通知機能
- 表記ゆれ対策ロジックの高度化（機械学習・類似度判定の導入など）
- 複数の外部パートナーごとの利用状況を管理するマルチテナント対応
- 認証・認可基盤（社内SSOや社内ポータルとの連携）の導入

これらの項目は、本番運用でのニーズや利用状況を踏まえて優先度を判断し、別途ロードマップとして整理する。
